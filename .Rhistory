legend.position = 'none')
HF_NM_contrasts
#Create forest plot for differences of treatments within strains
HF_contrasts <- ggplot(df_HF, aes(x = Comparison, y = logHR, colour = Strain)) +
geom_point(size = 4) +
geom_hline(yintercept = 0, linetype = "dashed", color = "grey50", linewidth = 1) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.2, size = 1.1)+
coord_flip() +
scale_x_discrete(labels = c('N2 \n daf-2 - ev','SKN-1 \n daf-2 - ev'))+
labs(
title = "",
x = "",
y = "Log hazard ratio (HR)"
) +
scale_colour_manual(values = c('#4DBBD5FF','#3C5488FF'))+
theme_minimal(base_size = 12)+
theme(axis.text = element_text(size = 12),
axis.title = element_text(size = 14),
legend.position = 'none')
#Create forest plot for differences of treatments within strains
CF_NM_contrasts <- ggplot(df_CF_NM, aes(x = Comparison, y = logHR, colour = Strain)) +
geom_point(size = 4) +
geom_hline(yintercept = 0, linetype = "dashed", color = "grey50", linewidth = 1) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.2, size = 1.1)+
coord_flip() +
scale_x_discrete(labels = c('N2 \n daf-2 - ev','SKN-1 \n daf-2 - ev'))+
labs(
title = "",
x = "",
y = "Log hazard ratio (HR)"
) +
scale_colour_manual(values = c('#4DBBD5FF','#3C5488FF'))+
theme_minimal(base_size = 12)+
theme(axis.text = element_text(size = 12),
axis.title = element_text(size = 14),
legend.position = 'none')
#Create forest plot for differences of treatments within strains
CF_contrasts <- ggplot(df_CF, aes(x = Comparison, y = logHR, colour = Strain)) +
geom_point(size = 4) +
geom_hline(yintercept = 0, linetype = "dashed", color = "grey50", linewidth = 1) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.2, size = 1.1)+
coord_flip() +
scale_x_discrete(labels = c('N2 \n daf-2 - ev','SKN-1 \n daf-2 - ev'))+
labs(
title = "",
x = "",
y = "Log hazard ratio (HR)"
) +
scale_colour_manual(values = c('#4DBBD5FF','#3C5488FF'))+
theme_minimal(base_size = 12)+
theme(axis.text = element_text(size = 12),
axis.title = element_text(size = 14),
legend.position = 'none')
#Group plots for both temperature starts
thermocycle_all <- ggarrange(THC_LS_plot$plot+ theme(plot.title = element_text(face = "bold")), THH_LS_plot$plot+ theme(plot.title = element_text(face = "bold")), CF_contrasts+theme(plot.margin = margin(t = 5, r = 25, b = 5, l = 25, unit = "pt")), HF_contrasts+theme(plot.margin = margin(t = 5, r = 25, b = 5, l = 25, unit = "pt")), nrow = 2, ncol = 2, common.legend = T, labels = c('A','B','C','D'), heights = c(1.5, 1))
thermocycle_all
#Group plots with matricides censored
thermocycle_all_NM <- ggarrange(LS_plot_matcen_THC$plot + theme(plot.title = element_text(face = "bold")), LS_plot_matcen_THH$plot+ theme(plot.title = element_text(face = "bold")), CF_NM_contrasts+theme(plot.margin = margin(t = 5, r = 25, b = 5, l = 25, unit = "pt")), HF_NM_contrasts+theme(plot.margin = margin(t = 5, r = 25, b = 5, l = 25, unit = "pt")), nrow = 2, ncol =2, common.legend = T, labels = c('A','B','C','D'), heights = c(1.5, 1))
thermocycle_all_NM
#Create forest plot for differences of treatments within strains
HF_NM_contrasts <- ggplot(df_HF_NM, aes(x = Comparison, y = logHR, colour = Strain)) +
geom_point(size = 4) +
geom_hline(yintercept = 0, linetype = "dashed", color = "grey50", linewidth = 0.8) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.2, size = 1.1)+
coord_flip() +
scale_x_discrete(labels = c('N2 \n daf-2 - ev','SKN-1 \n daf-2 - ev'))+
labs(
title = "",
x = "",
y = "Log hazard ratio (HR)"
) +
scale_colour_manual(values = c('#4DBBD5FF','#3C5488FF'))+
theme_minimal(base_size = 12)+
theme(axis.text = element_text(size = 12),
axis.title = element_text(size = 14),
legend.position = 'none')
HF_NM_contrasts
#Create forest plot for differences of treatments within strains
HF_contrasts <- ggplot(df_HF, aes(x = Comparison, y = logHR, colour = Strain)) +
geom_point(size = 4) +
geom_hline(yintercept = 0, linetype = "dashed", color = "grey50", linewidth = 0.8) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.2, size = 1.1)+
coord_flip() +
scale_x_discrete(labels = c('N2 \n daf-2 - ev','SKN-1 \n daf-2 - ev'))+
labs(
title = "",
x = "",
y = "Log hazard ratio (HR)"
) +
scale_colour_manual(values = c('#4DBBD5FF','#3C5488FF'))+
theme_minimal(base_size = 12)+
theme(axis.text = element_text(size = 12),
axis.title = element_text(size = 14),
legend.position = 'none')
HF_contrasts
#Group plots with matricides censored
thermocycle_all_NM <- ggarrange(LS_plot_matcen_THC$plot + theme(plot.title = element_text(face = "bold")), LS_plot_matcen_THH$plot+ theme(plot.title = element_text(face = "bold")), CF_NM_contrasts+theme(plot.margin = margin(t = 5, r = 25, b = 5, l = 25, unit = "pt")), HF_NM_contrasts+theme(plot.margin = margin(t = 5, r = 25, b = 5, l = 25, unit = "pt")), nrow = 2, ncol =2, common.legend = T, labels = c('A','B','C','D'), heights = c(1.5, 1))
thermocycle_all_NM
#Create forest plot for differences of treatments within strains
CF_NM_contrasts <- ggplot(df_CF_NM, aes(x = Comparison, y = logHR, colour = Strain)) +
geom_point(size = 4) +
geom_hline(yintercept = 0, linetype = "dashed", color = "grey50", linewidth = 0.8) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.2, size = 1.1)+
coord_flip() +
scale_x_discrete(labels = c('N2 \n daf-2 - ev','SKN-1 \n daf-2 - ev'))+
labs(
title = "",
x = "",
y = "Log hazard ratio (HR)"
) +
scale_colour_manual(values = c('#4DBBD5FF','#3C5488FF'))+
theme_minimal(base_size = 12)+
theme(axis.text = element_text(size = 12),
axis.title = element_text(size = 14),
legend.position = 'none')
#Create forest plot for differences of treatments within strains
CF_contrasts <- ggplot(df_CF, aes(x = Comparison, y = logHR, colour = Strain)) +
geom_point(size = 4) +
geom_hline(yintercept = 0, linetype = "dashed", color = "grey50", linewidth = 0.8) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.2, size = 1.1)+
coord_flip() +
scale_x_discrete(labels = c('N2 \n daf-2 - ev','SKN-1 \n daf-2 - ev'))+
labs(
title = "",
x = "",
y = "Log hazard ratio (HR)"
) +
scale_colour_manual(values = c('#4DBBD5FF','#3C5488FF'))+
theme_minimal(base_size = 12)+
theme(axis.text = element_text(size = 12),
axis.title = element_text(size = 14),
legend.position = 'none')
#Group plots for both temperature starts
thermocycle_all <- ggarrange(THC_LS_plot$plot+ theme(plot.title = element_text(face = "bold")), THH_LS_plot$plot+ theme(plot.title = element_text(face = "bold")), CF_contrasts+theme(plot.margin = margin(t = 5, r = 25, b = 5, l = 25, unit = "pt")), HF_contrasts+theme(plot.margin = margin(t = 5, r = 25, b = 5, l = 25, unit = "pt")), nrow = 2, ncol = 2, common.legend = T, labels = c('A','B','C','D'), heights = c(1.5, 1))
thermocycle_all
ggsave("thermocycle_all.png", bg = 'white',plot = thermocycle_all, width = 10, height = 6, dpi = 300, units = "in")
#Group plots with matricides censored
thermocycle_all_NM <- ggarrange(LS_plot_matcen_THC$plot + theme(plot.title = element_text(face = "bold")), LS_plot_matcen_THH$plot+ theme(plot.title = element_text(face = "bold")), CF_NM_contrasts+theme(plot.margin = margin(t = 5, r = 25, b = 5, l = 25, unit = "pt")), HF_NM_contrasts+theme(plot.margin = margin(t = 5, r = 25, b = 5, l = 25, unit = "pt")), nrow = 2, ncol =2, common.legend = T, labels = c('A','B','C','D'), heights = c(1.5, 1))
thermocycle_all_NM
ggsave("thermocycle_NM_all.png", plot = thermocycle_all_NM, bg = 'white',width = 10, height = 6, dpi = 300, units = "in")
#create plot combining N2 and SKN
SKN_N2_25NM_HR <- ggplot(all_25NM_df, aes(x = estimate, y = label, color = contrast)) +
geom_point(size = 4) +
geom_errorbarh(aes(xmin = lower.CL, xmax = upper.CL), height = 0.2, linewidth = 1.1) +
geom_vline(xintercept = 0, linetype = "dashed", color = "grey50", size = 0.8) +
labs(x = "Log Hazard Ratio", y = "") +
scale_color_manual(values = c('#4DBBD5FF', '#3C5488FF','#F39B7FFF'))+
scale_y_discrete(labels = c('N2: \n daf-2 - ev', 'SKN-1: \n daf-2 - ev','SKN-1: \n daf-2 + cycle - ev' ))+
theme_minimal()+
theme(legend.position = 'none',
axis.text= element_text(size = 12),
axis.title = element_text(size = 14))+
guides(color = "none", fill = "none", shape = "none")
#Plot HRs for N2 and SKN-1 together
SKN_N2_25_HR <- ggplot(all_25_df, aes(x = estimate, y = label, color = contrast)) +
geom_point(size = 4) +
geom_errorbarh(aes(xmin = lower.CL, xmax = upper.CL), height = 0.2, linewidth = 1.1) +
geom_vline(xintercept = 0, linetype = "dashed", color = "grey50", size = 0.8) +
labs(x = "Log Hazard Ratio", y = "") +
scale_color_manual(values = c('#4DBBD5FF', '#3C5488FF','#F39B7FFF'))+
scale_y_discrete(labels = c('N2: \n daf-2 - ev', 'SKN-1: \n daf-2 - ev','SKN-1: \n daf-2 + cycle - ev' ))+
theme_minimal()+
theme(legend.position = 'none',
axis.text= element_text(size = 12),
axis.title = element_text(size = 14))+
guides(color = "none", fill = "none", shape = "none")
#Plot HRs for N2 and SKN-1 together
SKN_N2_15_HR <- ggplot(all_15_df, aes(x = estimate, y = label, color = contrast)) +
geom_point(size = 4) +
geom_errorbarh(aes(xmin = lower.CL, xmax = upper.CL), height = 0.2, linewidth = 1.1) +
geom_vline(xintercept = 0, linetype = "dashed", color = "grey50", size = 0.8) +
labs(x = "Log Hazard Ratio", y = "") +
scale_color_manual(values = c('#4DBBD5FF', '#3C5488FF','#F39B7FFF'))+
scale_y_discrete(labels = c('N2: \n daf-2 - ev', 'SKN-1: \n daf-2 - ev','SKN-1: \n daf-2 + cycle - ev' ))+
theme_minimal()+
theme(legend.position = 'none',
axis.text= element_text(size = 12),
axis.title = element_text(size = 14))+
guides(color = "none", fill = "none", shape = "none")
#create plot combinding
SKN_N2_15NM_HR <- ggplot(all_15NM_df, aes(x = estimate, y = label, color = contrast)) +
geom_point(size = 4) +
geom_errorbarh(aes(xmin = lower.CL, xmax = upper.CL), height = 0.2, linewidth = 1.1) +
geom_vline(xintercept = 0, linetype = "dashed", color = "grey50", size = 0.8) +
labs(x = "Log Hazard Ratio", y = "") +
scale_color_manual(values = c('#4DBBD5FF', '#3C5488FF','#F39B7FFF'))+
scale_y_discrete(labels = c('N2: \n daf-2 - ev', 'SKN-1: \n daf-2 - ev','SKN-1: \n daf-2 + cycle - ev' ))+
theme_minimal()+
theme(legend.position = 'none',
axis.text= element_text(size = 12),
axis.title = element_text(size = 14))+
guides(color = "none", fill = "none", shape = "none")
SKN_15_25_all <- ggarrange(SKN_15_plot$plot+ theme(plot.title = element_text(face = "bold")), SKN_25_plot$plot+ theme(plot.title = element_text(face = "bold")), SKN_N2_15_HR,  SKN_N2_25_HR, nrow = 2, ncol = 2, common.legend = T, labels = c('A','B','C','D'), heights = c(1.5, 1))
SKN_15_25_all
ggsave("SKN_15_25_all.png", plot = SKN_15_25_all, bg = 'white',width = 10, height = 6, dpi = 300, units = "in")
SKN_15_25_NM_all <- ggarrange(SKN_15_NM_plot$plot+ theme(plot.title = element_text(face = "bold")), SKN_25_NM_plot$plot+ theme(plot.title = element_text(face = "bold")), SKN_N2_15NM_HR,  SKN_N2_25NM_HR+theme(plot.margin = margin(t = 5, r = 25, b = 5, l = 5, unit = "pt")), nrow = 2, ncol = 2, common.legend = T, labels = c('A','B','C','D'), heights = c(1.5,1))
SKN_15_25_NM_all
ggsave("SKN_15_25_NM_all.png", plot = SKN_15_25_NM_all, bg = 'white',width = 10, height = 6, dpi = 300, units = "in")
#Create forest plot for differences of treatments within strains
SKN_contrasts <- ggplot(df_SKN, aes(x = Comparison, y = logHR)) +
geom_point(size = 4, color = '#4DBBD5FF') +
geom_hline(yintercept = 0, linetype = "dashed", size = 1.2, color = 'grey50', linewidth = 0.8) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.2, size = 1.1,color ='#4DBBD5FF')+
coord_flip() +
#scale_x_discrete(labels = c('N2 \n daf-2 - ev','SKN-1 \n daf-2 - ev'))+
labs(
title = "",
x = "Treatment comparison",
y = "Log hazard ratio (HR)"
) +
theme_minimal(base_size = 12)+
theme(axis.text = element_text(size = 12),
axis.title = element_text(size = 14),
legend.position = 'none')
#Get rid of NAs
SKN_20C_LS <- na.omit(SKN_20C_LS)
#Rename daf to daf-2
SKN_20C_LS$Treatment.ID <- revalue(SKN_20C_LS$Treatment.ID, c('ev' = 'ev', 'daf' = 'daf-2'))
#Make sure Treatment is a factor
SKN_20C_LS$Treatment.ID <- as.factor(SKN_20C_LS$Treatment.ID)
#Make ev the baseline level
SKN_20C_LS$Treatment.ID <- relevel(SKN_20C_LS$Treatment.ID, ref = 'ev')
#Check factor levels of treatment
levels(SKN_20C_LS$Treatment.ID)
#Get rid of empty levels
SKN_20C_LS$Treatment.ID <- droplevels(SKN_20C_LS$Treatment.ID)
#Plate.ID as a factor not a numerical
SKN_20C_LS$Plate.ID <- as.factor(SKN_20C_LS$Plate.ID)
#Create survival object for SKN-1 mutants at 20C
surv_SKN<-survfit(Surv(Age,Event)~Treatment.ID,data=SKN_20C_LS)
#Create survival curve from survival object
SKN_20C_LS_plot <-ggsurvplot(surv_SKN, ylab="Survival probability\n", data = SKN_20C_LS, size= 0.8, font.ylab= 14, font.xlab= 14, palette=c('#E64B35FF','#4DBBD5FF'), legend = c(0.8, 0.8), legend.title = "", legend.labs = c('ev','daf-2'), title = "", censor = FALSE, xlab = "Day", xlim=c(0,35), break.time.by = 5, position= position_dodge(0.9), font.tickslab = c(12), font.legend = c(12))
SKN_20C_LS_plot
#Mixed effects cox model for a effect of daf-2 on SKN-1 mutant lifespan
cox_SKN_20C <- coxme(Surv(Age, Event) ~ Treatment.ID + (1|Plate.ID), data = SKN_20C_LS)
summary(cox_SKN_20C)
Anova(cox_SKN_20C, type = 'II')
#test model
cox.zph(cox_SKN_20C)#OK
#Use emmeans because of negligible effect of plate.ID
SKN_emm <- emmeans(cox_SKN_20C, ~ Treatment.ID)  # EMMs of treatment
SKN_emm
#Get contrasts
contrasts_SKN <- contrast(SKN_emm, method = "revpairwise")
#make a dataframe out of the contrast summary
df_SKN <- as.data.frame(summary(contrasts_SKN, infer = TRUE))
# Rename columns
names(df_SKN)[names(df_SKN) == "estimate"] <- "logHR"
df_SKN$HR <- exp(df_SKN$logHR)
df_SKN$lower.HR <- exp(df_SKN$asymp.LCL)
df_SKN$upper.HR <- exp(df_SKN$asymp.UCL)
#fix labels
df_SKN$Comparison <- df_SKN$contrast
#Create forest plot for differences of treatments within strains
SKN_contrasts <- ggplot(df_SKN, aes(x = Comparison, y = logHR)) +
geom_point(size = 4, color = '#4DBBD5FF') +
geom_hline(yintercept = 0, linetype = "dashed", size = 1.2, color = 'grey50', linewidth = 0.8) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.2, size = 1.1,color ='#4DBBD5FF')+
coord_flip() +
#scale_x_discrete(labels = c('N2 \n daf-2 - ev','SKN-1 \n daf-2 - ev'))+
labs(
title = "",
x = "Treatment comparison",
y = "Log hazard ratio (HR)"
) +
theme_minimal(base_size = 12)+
theme(axis.text = element_text(size = 12),
axis.title = element_text(size = 14),
legend.position = 'none')
SKN_contrasts
#Exclude matricides
SKN_20C_LS_NM <- SKN_20C_LS %>%
filter(Cause != 'M')
#Create survival object
surv_SKN_NM<-survfit(Surv(Age,Event)~Treatment.ID,data=SKN_20C_LS_NM)
#Survival plot
SKN_NM_LS_plot <-ggsurvplot(surv_SKN_NM, ylab="Survival probability", data = SKN_20C_LS_NM, size= 0.8, font.ylab= 14, font.xlab= 14, palette=c('#E64B35FF','#4DBBD5FF'), legend = c(0.8, 0.8), legend.title = "", legend.labs = c('ev','daf-2'), title = "", censor = FALSE, xlab = "Day", xlim=c(0,35), break.time.by = 5, position= position_dodge(0.9), font.tickslab = c(12), font.legend = c(12))
SKN_NM_LS_plot
#Cox mixed effects model
cox_SKN_20C_NM <- coxme(Surv(Age, Event) ~ Treatment.ID + (1|Plate.ID), data = SKN_20C_LS_NM)
summary(cox_SKN_20C_NM)
Anova(cox_SKN_20C_NM, type = 'II')
#Test model
cox.zph(cox_SKN_20C_NM)#OK
#Use emmeans because of negligible effect of plate.ID
SKN_NM_emm <- emmeans(cox_SKN_20C_NM, ~ Treatment.ID)  # EMMs of treatment
SKN_NM_emm
#Get contrasts
contrasts_SKN_NM <- contrast(SKN_NM_emm, method = "revpairwise")
#make a dataframe out of the contrast summary
df_SKN_NM <- as.data.frame(summary(contrasts_SKN_NM, infer = TRUE))
# Rename columns
names(df_SKN_NM)[names(df_SKN_NM) == "estimate"] <- "logHR"
df_SKN_NM$HR <- exp(df_SKN_NM$logHR)
df_SKN_NM$lower.HR <- exp(df_SKN_NM$asymp.LCL)
df_SKN_NM$upper.HR <- exp(df_SKN_NM$asymp.UCL)
#fix labels
df_SKN_NM$Comparison <- df_SKN_NM$contrast
#Create forest plot for differences of treatments within strains
SKN_NM_contrasts <- ggplot(df_SKN_NM, aes(x = Comparison, y = logHR)) +
geom_point(size = 4, color = '#4DBBD5FF') +
geom_hline(yintercept = 0, linetype = "dashed", size = 1.2, color = 'grey50', linewidth = 0.8) +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL), width = 0.2, size = 1.1,color ='#4DBBD5FF')+
coord_flip() +
#scale_x_discrete(labels = c('N2 \n daf-2 - ev','SKN-1 \n daf-2 - ev'))+
labs(
title = "",
x = "Treatment comparison",
y = "Log hazard ratio (HR)"
) +
theme_minimal(base_size = 12)+
theme(axis.text = element_text(size = 12),
axis.title = element_text(size = 14),
legend.position = 'none')
SKN_NM_contrasts
#Group all plots for 20C skn-1 data
SKN_20C_all <- ggarrange(SKN_NM_LS_plot$plot, skn_20C_p, SKN_NM_contrasts+theme(plot.margin = margin(t = 5, r = 5, b = 25, l = 40, unit = "pt")), tot_rep_SKN_plot+theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 40, unit = "pt")), heights = c(1.3, 1), common.legend = T, labels = c('A','B','C','D'))
SKN_20C_all
ggsave("SKN_20C_all.png", plot = SKN_20C_all, bg = 'white',width = 10, height = 8, dpi = 300, units = "in")
#Group all plots for 20C skn-1 data
SKN_20C_all <- ggarrange(SKN_NM_LS_plot$plot, skn_20C_p, SKN_NM_contrasts+theme(plot.margin = margin(t = 5, r = 5, b = 25, l = 40, unit = "pt")), tot_rep_SKN_plot+theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 40, unit = "pt")), heights = c(1.3, 1), common.legend = T, labels = c('A','B','C','D'))
#put data into long form
skn_long <- SKN_20C_rep %>%
pivot_longer(
cols = c(`D1`, `D2`, `D3`, `D4`, `D5`),
names_to = "Day",
values_to = "value")
#select only columns needed
skn_long <- skn_long %>%
dplyr::select(c('ID','Treatment','Day','value'))
#rename treatments
skn_long$Treatment <- as.factor(skn_long$Treatment)
levels(skn_long$Treatment) <- list('ev' = 'ev', 'daf-2' = 'daf')
#get rid of NAs
skn_long <- na.omit(skn_long)
#age-specific reproduction plot for SKN-1 mutants with daf or ev
skn_20C_p <-ggplot(data=skn_long, aes(x=factor(Day), y=value, group=Treatment, color=Treatment))+
geom_jitter(alpha = 0.2, position = position_jitterdodge(jitter.width = 0.2, dodge.width = 0.5))+
stat_summary(fun.data="mean_cl_boot", geom="errorbar", size = 1.2, width=0.0, position = position_dodge(0.5)) +
stat_summary(fun.data="mean_cl_boot", geom="point", size = 3, position = position_dodge(0.5)) +
stat_summary(fun.data="mean_cl_boot", geom="line",  size=1.2, position = position_dodge(0.5)) +
theme_classic()+
labs(y="Offspring number", x="Day")+
labs(col="")+
theme(axis.title.y = element_text(size=14))+
theme(axis.title.x = element_text(size=14))+
theme(axis.text= element_text(size = 12))+
theme(legend.text = element_text(size = 12))+
scale_color_manual(values=c('#E64B35FF','#4DBBD5FF'))+
theme(legend.key.width = unit(0.5,"cm"))+
coord_cartesian(ylim = c(0,225))+
theme(legend.position = c(0.1, 0.9))
skn_20C_p
#Get Day into a numeric form
#Change day to a numeric variable for analysis
skn_long$Day <- as.factor(skn_long$Day)
levels(skn_long$Day) <- list('1' = 'D1', '2' = 'D2', '3' = 'D3', '4' = 'D4', '5' = 'D5')
skn_long$Day <- as.numeric(skn_long$Day)
#set ev as reference level
skn_long$Treatment <- as.factor(skn_long$Treatment)
skn_long$Treatment <- relevel(skn_long$Treatment, ref = 'ev')
#Age-specific reproduction aanalysis with negative binomial GLMM
m1_SKN <- glmmTMB(value ~ Treatment * Day + (1|ID), family = nbinom2(), data = skn_long)
summary(m1_SKN)
#model diagnostics
sim_SKN1 <- simulateResiduals(m1_SKN, plot = T)
testDispersion(sim_SKN1)#underdispersed
testZeroInflation(sim_SKN1)#zero-inflated
#Try adding zero inflation formula
m2_SKN <- glmmTMB(value ~ Treatment*Day + (1|ID), ziformula = ~Day, family = nbinom2(), data = skn_long)
summary(m2_SKN)#won't converge, try removing interaction (appears nonsig in previous model)
#Remove interaction
m3_SKN <- glmmTMB(value ~ Treatment + Day + (1|ID), family = nbinom2(), ziformula = ~ Day, data = skn_long)
summary(m3_SKN)
#diagnostic
sim_SKN3 <- simulateResiduals(m3_SKN, plot = T)
testZeroInflation(sim_SKN3)
testDispersion(sim_SKN3)
### Try a poisson model
m4_SKN <- glmmTMB(value ~ Treatment * Day + (1|ID), family = poisson(), data = skn_long)
AIC(m1_SKN, m4_SKN)#poisson has MUCH higher AIC
#compare other models
AIC(m1_SKN, m2_SKN, m3_SKN) #m3 is worse than m1
#Try adding Day^2
m5_SKN <- glmmTMB(value ~ Treatment * I(Day^2) + Treatment*Day + (1|ID), family = nbinom2(), data = skn_long)
AIC(m1_SKN, m5_SKN)#huge improvement
sim_SKN5 <- simulateResiduals(m5_SKN, plot = T)
testDispersion(sim_SKN5)
testZeroInflation(sim_SKN5)
summary(m5_SKN)
#Try adding zi formula
m6_SKN <- glmmTMB(value ~ Treatment * I(Day^2) + Treatment*Day + (1|ID), ziformula = ~Day, family = nbinom2(), data = skn_long)
#won't converge
#Remove interaction between Treatment and Day
m7_SKN <- glmmTMB(value ~ Treatment*I(Day^2) + Day + (1|ID), ziformula = ~Day, family = nbinom2(), data = skn_long)
summary(m7_SKN)
Anova(m7_SKN, type = 'III')
sim_SKN7 <- simulateResiduals(m7_SKN, plot = T)
testDispersion(sim_SKN7)
m8_SKN <- glmmTMB(value ~ Treatment * Day + I(Day^2) + (1|ID), ziformula = ~Day, family = nbinom2(), data = skn_long )
AIC(m7_SKN, m8_SKN)#these models are pretty much the same - use previous one as interest is in how treatment affect offspring number of days in curved day variable
sim_SKN8 <- simulateResiduals(m8_SKN, plot = T)
testDispersion(sim_SKN8)
#sum up total number of offspring produced over experiment per individual
totalrep_SKN<-na.omit(as.data.frame.table(tapply(skn_long$value,list(skn_long$Treatment, skn_long$ID),sum)))
#rename columns
names(totalrep_SKN)<-c("Treatment", "Replicate", "Totrep")
#create dabestr object for plotting cumming estimation
totrep_SKN_dab <-
totalrep_SKN %>%
load(x =Treatment, y=Totrep,
idx = c('ev','daf-2'))
#get mean differences for plot
totrep_SKN_p <- mean_diff(totrep_SKN_dab)
#cumming estimation plot for LRS in SKN-1 at 20C with daf or ev
tot_rep_SKN_plot <- dabest_plot(totrep_SKN_p, FALSE, raw_marker_spread = 1, swarm_label = 'LRS',custom_palette = 'npg', swarm_x_text = 14, swarm_y_text = 14, contrast_y_text = 16, contrast_x_text = 14, raw_marker_alpha = 0.3, tufte_size = 1 )
tot_rep_SKN_plot
#Look at distribution
hist(totalrep_SKN$Totrep)#pretty skewed - but try LM
#Try running basic linear model
SKN_LRS_m1 <- lm(value ~ Treatment, data = skn_long)
summary(SKN_LRS_m1)
SKN_LRS_sim1 <- simulateResiduals(SKN_LRS_m1, plot = T)
#Try a Gamma GLM
SKN_LRS_m2 <- glm(Totrep ~ Treatment, data = totalrep_SKN, family = Gamma(link = 'log'))
summary(SKN_LRS_m2)
SKN_LRS_sim2 <- simulateResiduals(SKN_LRS_m2, plot = T)
#Try link = inverse
SKN_LRS_m3 <- glm(Totrep ~ Treatment, data = totalrep_SKN, family = Gamma(link = 'inverse'))
summary(SKN_LRS_m3)
SKN_LRS_sim3 <- simulateResiduals(SKN_LRS_m3, plot = T)
Anova(SKN_LRS_m3, type = 'II')
totalrep_SKN$Treatment <- as.factor(totalrep_SKN$Treatment)
new_data2 <- data.frame(Treatment = levels(totalrep_SKN$Treatment))
# Predict on response scale (i.e., expected Totrep, not log)
pred <- predict(SKN_LRS_m2, newdata = new_data2, type = "response", se.fit = TRUE)
# Add predictions to data frame
new_data2$fit <- pred$fit
new_data2$se <- pred$se.fit
new_data2$lower <- new_data2$fit - 1.96 * new_data2$se
new_data2$upper <- new_data2$fit + 1.96 * new_data2$se
ggplot(new_data2, aes(x = Treatment, y = fit)) +
geom_point(size = 3) +
geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.2) +
labs(y = "Predicted LRS",
title = "Gamma GLM predictions") +
theme_minimal()
#predictions look right, stick with Gamma model
#Group all plots for 20C skn-1 data
SKN_20C_all <- ggarrange(SKN_NM_LS_plot$plot, skn_20C_p, SKN_NM_contrasts+theme(plot.margin = margin(t = 5, r = 5, b = 25, l = 40, unit = "pt")), tot_rep_SKN_plot+theme(plot.margin = margin(t = 5, r = 5, b = 5, l = 40, unit = "pt")), heights = c(1.3, 1), common.legend = T, labels = c('A','B','C','D'))
SKN_20C_all
ggsave("SKN_20C_all.png", plot = SKN_20C_all, bg = 'white',width = 10, height = 8, dpi = 300, units = "in")
#Matricides included for suppmat
SKN_20C_LS_all <- ggarrange(SKN_20C_LS_plot$plot, SKN_contrasts+theme(plot.margin = margin(t = 5, r = 45, b = 5, l = 45, unit = "pt")), nrow = 2, heights = c(2,1), common.legend = T)
SKN_20C_LS_all
ggsave("SKN_20C_LS_all.png", plot = SKN_20C_LS_all, bg = 'white',width = 8, height = 10, dpi = 300, units = "in")
ggsave("SKN_20C_LS_all.png", plot = SKN_20C_LS_all, bg = 'white',width = 8, height = 6, dpi = 300, units = "in")
ggsave("SKN_20C_LS_all.png", plot = SKN_20C_LS_all, bg = 'white',width = 6, height = 6, dpi = 300, units = "in")
#Matricides included for suppmat
SKN_20C_LS_all <- ggarrange(SKN_20C_LS_plot$plot, SKN_contrasts+theme(plot.margin = margin(t = 5, r = 45, b = 5, l = 45, unit = "pt")), nrow = 2, heights = c(2,1), common.legend = T, labels = c('A','B'))
SKN_20C_LS_all
ggsave("SKN_20C_LS_all.png", plot = SKN_20C_LS_all, bg = 'white',width = 6, height = 6, dpi = 300, units = "in")
#Get rid of NAs
SKN_20C_LS <- na.omit(SKN_20C_LS)
#Rename daf to daf-2
SKN_20C_LS$Treatment.ID <- revalue(SKN_20C_LS$Treatment.ID, c('ev' = 'ev', 'daf' = 'daf-2'))
#Make sure Treatment is a factor
SKN_20C_LS$Treatment.ID <- as.factor(SKN_20C_LS$Treatment.ID)
#Make ev the baseline level
SKN_20C_LS$Treatment.ID <- relevel(SKN_20C_LS$Treatment.ID, ref = 'ev')
#Check factor levels of treatment
levels(SKN_20C_LS$Treatment.ID)
#Get rid of empty levels
SKN_20C_LS$Treatment.ID <- droplevels(SKN_20C_LS$Treatment.ID)
#Plate.ID as a factor not a numerical
SKN_20C_LS$Plate.ID <- as.factor(SKN_20C_LS$Plate.ID)
#Create survival object for SKN-1 mutants at 20C
surv_SKN<-survfit(Surv(Age,Event)~Treatment.ID,data=SKN_20C_LS)
#Mixed effects cox model for a effect of daf-2 on SKN-1 mutant lifespan
cox_SKN_20C <- coxme(Surv(Age, Event) ~ Treatment.ID + (1|Plate.ID), data = SKN_20C_LS)
summary(cox_SKN_20C)
Anova(cox_SKN_20C, type = 'II')
#Cox mixed effects model
cox_SKN_20C_NM <- coxme(Surv(Age, Event) ~ Treatment.ID + (1|Plate.ID), data = SKN_20C_LS_NM)
summary(cox_SKN_20C_NM)
Anova(cox_SKN_20C_NM, type = 'II')
#Get contrasts
contrasts_HF_NM <- contrast(HF_NM_emm, method = "pairwise", by = "Strain")
contrasts_NF_NM
contrasts_HF_NM
#Use emmeans because of negligible effect of plate.ID
CF_emm <- emmeans(CF_cox, ~ Treatment.ID | Strain)  # EMMs of treatment within each strain
CF_emm
#Get contrasts
contrasts_CF <- contrast(CF_emm, method = "pairwise", by = "Strain")
contrasts_CF
#Use emmeans because of negligible effect of plate.ID
CF_NM_emm <- emmeans(CF_NM_cox, ~ Treatment.ID | Strain)  # EMMs of treatment within each strain
CF_NM_emm
#Get contrasts
contrasts_CF_NM <- contrast(CF_NM_emm, method = "pairwise", by = "Strain")
contrasts_CF_NM
#Use emmeans because of negligible effect of plate.ID
HF_emm <- emmeans(HF_cox, ~ Treatment.ID | Strain)  # EMMs of treatment within each strain
HF_emm
#Get contrasts
contrasts_HF <- contrast(HF_emm, method = "pairwise", by = "Strain")
contrasts_HF
HF_NM_emm
#Get contrasts
contrasts_HF_NM <- contrast(HF_NM_emm, method = "pairwise", by = "Strain")
contrasts_HF_NM
